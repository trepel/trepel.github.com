{"commit":{"parents":[{"id":"173a55614ffca2700b01c1e378657447420b0e49"}],"message":"ARQ-627 Replace the nodeHost value from the REST response, with the\nadminHost value, when the returned value is \"localhost\".","tree":"ba9a9ca2bd70f79d7d32dfbf0c3ff42515e8c240","modified":[{"filename":"glassfish-remote-3.1/src/main/java/org/jboss/arquillian/container/glassfish/remote_3_1/clientutils/GlassFishClientService.java","diff":"@@ -387,7 +387,24 @@ private void resolveWebModuleSubComponents(String name, String module, String co\n \tprotected String getHostAddress(Map<String, String> serverAttributes) \n \t{\n         String path = NODE_RESOURCE.replace(\"{node}\", serverAttributes.get(\"nodeRef\"));\n-        return getClientUtil().getAttributes(path).get(\"nodeHost\");\n+        String nodeHost = getClientUtil().getAttributes(path).get(\"nodeHost\");\n+        \n+        // If the host address returned by DAS was \"localhost\", it could be \"localhost\" in the context of DAS, but not Arquillian.\n+        // This would result in Arquillian connecting to localhost, even though the DAS (and it's localhost) is on a separate machine.\n+        // This is the case when the Glassfish installer or asadmin creates a localhost node with node-host set to \"localhost\" instead of a FQDN.\n+        // Variants of \"localhost\" like \"127.0.0.1\" or ::1 are not addressed, as the installer/asadmin does not appear to set the node-host to such values.\n+        // In such a scenario, the adminHost (DAS) known to Arquillian (from arquillian.xml) will be used as the nodeHost.\n+        // All conditions are addressed:\n+        // 1. If adminHost is \"localhost\", and the node-host registered in DAS is \"localhost\", then the node-host is set to \"localhost\". No harm done.\n+        // 2. If adminHost is not \"localhost\", and the node-host registered in DAS is \"localhost\", then the node-host value will be set to the same as adminHost.\n+        // Prevents Arquillian from connecting to a wrong address (localhost) to run the tests via ArquillianTestRunner.\n+        // 3. If adminHost is \"localhost\" and the node-host registered in DAS is not \"localhost\", then the value from DAS will be used.\n+        // 4. If adminHost is not \"localhost\" and the node-host registered in DAS is not \"localhost\", then the value from DAS will be used.\n+        if (nodeHost.equals(\"localhost\"))\n+        {\n+           nodeHost = configuration.getAdminHost();\n+        }\n+        return nodeHost;\n \t}\n \t/**\n \t * Get the http/https port number of the Admin Server"}],"committer":{"email":"Vineet.Reynolds@gmail.com","login":"VineetReynolds","name":"Vineet Reynolds"},"authored_date":"2011-10-20T12:42:27-07:00","url":"/arquillian/arquillian-container-glassfish/commit/f329831338a9e7127e266833e2c6228207658b66","committed_date":"2011-10-20T12:42:27-07:00","id":"f329831338a9e7127e266833e2c6228207658b66","author":{"email":"Vineet.Reynolds@gmail.com","login":"VineetReynolds","name":"Vineet Reynolds"}}}