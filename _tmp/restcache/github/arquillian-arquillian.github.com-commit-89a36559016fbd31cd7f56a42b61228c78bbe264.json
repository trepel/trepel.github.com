{"commit":{"id":"89a36559016fbd31cd7f56a42b61228c78bbe264","url":"/arquillian/arquillian.github.com/commit/89a36559016fbd31cd7f56a42b61228c78bbe264","author":{"name":"Bob McWhirter","email":"bob@mcwhirter.org","login":"bobmcwhirter"},"authored_date":"2012-04-25T08:50:33-07:00","tree":"2c17b5de87ff697b140266331b4a11894a5dcfc4","parents":[{"id":"1393ca1fbcdc13dbc575002e3b7eb15c0cc529ec"}],"message":"Use nested Pages for release boilerplate.  Adjust the summary of posts\non the front page to account for a release content without two sentences.\nMore changes for awestructx, and dealing with slugs on posts instead of\naltering relative_source_path.","modified":[{"filename":"Gemfile.lock","diff":"@@ -1,6 +1,7 @@\n GEM\n   remote: http://rubygems.org/\n   specs:\n+    RedCloth (4.2.9)\n     RedCloth (4.2.9-java)\n     awestruct (0.2.15)\n       RedCloth (~> 4.2.9)\n@@ -28,15 +29,18 @@ GEM\n       sass (~> 3.1)\n     compass-960-plugin (0.10.4)\n       compass (>= 0.10.0)\n+    ffi (1.0.11)\n     ffi (1.0.11-java)\n     fssm (0.2.8.1)\n     git (1.2.5)\n     haml (3.1.4)\n     hashery (1.5.0)\n       blankslate\n+    hpricot (0.8.6)\n     hpricot (0.8.6-java)\n     jruby-openssl (0.7.6.1)\n       bouncy-castle-java (>= 1.5.0146.1)\n+    json (1.6.6)\n     json (1.6.6-java)\n     mime-types (1.18)\n     notifier (0.1.4)\n@@ -55,6 +59,7 @@ GEM\n \n PLATFORMS\n   java\n+  ruby\n \n DEPENDENCIES\n   awestruct (= 0.2.15)"},{"filename":"_ext/releases.rb","diff":"@@ -49,9 +49,15 @@ def execute(site)\n             inner_release_page.relative_source_path = inner_release_page.output_path\n           end\n \n-          # FIXME we can use site.layouts to get the layout\n-          layouts_dir = File.basename site.engine.config.layouts_dir\n-          release_page = site.engine.find_and_load_site_page(File.join(layouts_dir, 'release'))\n+\n+          inner_release_page.layout    = 'release'\n+          inner_release_page.release   = release\n+          inner_release_page.date      = release.date\n+          inner_release_page.component = component\n+\n+          release_page = Awestruct::Page.new( site, inner_release_page )\n+          release_page.prepare!\n+          release_page.layout = 'post'\n           release_page.output_path = File.join(@path_prefix, release_page_name.tr('.', '-')) + '.html'\n \n           release.page = release_page\n@@ -84,21 +90,9 @@ def execute(site)\n             release_page.release_notes = site.release_notes[release.key]\n           end\n \n-          # Fix date calculation performed by Posts extension\n-          release_page.relative_source_path =\n-              File.join(@path_prefix, release_page.date.strftime('%Y-%m-%d-') + release_page_name.tr('.', '-')) + '.html'\n+          # Fix page slugging by NOT alterating the relative-source-path.\n+          release_page.slug = release_page_name.tr('.', '-')\n \n-          # pre-render the content so that the entry can be wrapped in the common release text\n-          release_page.rendered_content = release_page.render(site.engine.create_context(release_page, inner_release_page.content))\n-          class << release_page\n-            def render(context)\n-              self.rendered_content\n-            end\n-\n-            def content\n-              self.rendered_content\n-            end\n-          end\n           site.pages << release_page\n         end\n       end"},{"filename":"_layouts/release.html.haml","diff":"@@ -1,6 +1,3 @@\n----\n-layout: post\n----\n %p The Arquillian team is proud to announce the <em>#{page.release.version}</em> release of the <em>#{page.component.name}</em> component!\n ~ content\n %h3 What is Arquillian?"},{"filename":"index.html.haml","diff":"@@ -109,7 +109,10 @@ body_class: home\n                 -#%p= summarize(html_to_text(cut_at ? post.content[0,cut_at] : post.content), 50)\n                 - text = html_to_text(cut_at ? post.content[0, cut_at] : post.content)\n                 -# might want to use 'white-space: pre-line;' here\n-                %p<= text[0..text.index(/[\\.\\!]( |$)/, [text.index(/[\\.\\!]( |$)/) + 1, text.length - 1].min)] + '...'\n+                - first_sentence = text.index(/[\\.\\!]( |$)/)\n+                - second_sentence = text.index(/[\\.\\!]( |$)/, [ first_sentence + 1, text.length - 1].min) || text.index(/[ ]/, [ first_sentence + 1, text.length - 1 ].min)\n+                - summary = text[0..second_sentence]\n+                %p<= summary + '...'\n         .more\n           %a(href='/blog') View all blog entries &raquo;\n       #events"}],"committed_date":"2012-06-14T03:13:40-07:00","committer":{"name":"Aslak Knutsen","email":"aslak@redhat.com","login":"aslakknutsen"}}}