{"commit":{"author":{"login":"ropalka","name":"Richard Opalka","email":"opalka.richard@gmail.com"},"url":"/jbossas/jboss-as/commit/a67d69edd68343173a2ba47e8c14b63dd4487e79","id":"a67d69edd68343173a2ba47e8c14b63dd4487e79","parents":[{"id":"a5937b4dc7b03fe51872cbd3a7c2dccdcd9333a1"}],"message":"implement fugly MBean attribute inspection","tree":"53a22992351dd29d06685bd35d279ab645037a04","modified":[{"diff":"@@ -66,8 +66,10 @@\n public class TunneledMBeanServerConnection implements MBeanServerConnection {\n     private static final String INVOKE_MBEAN_RAW = \"invoke-mbean-raw\";\n     private static final String GET_MBEAN_INFO_RAW =\"get-mbean-info-raw\";\n+    private static final String GET_MBEAN_ATTRIBUTE_INFO_RAW = \"get-mbean-attribute-info-raw\";\n     private static final String JMX = \"jmx\";\n     private static final String MBEAN_NAME = \"mbean-name\";\n+    private static final String MBEAN_ATTRIBUTE_NAME = \"mbean-attribute-name\";\n     private static final String MBEAN_OPERATION_NAME = \"mbean-operation-name\";\n     private static final String NOTIFICATION_FILE = \"notification-file\";\n     private static final String SIGNATURE = \"signature\";\n@@ -120,7 +122,23 @@ public Integer getMBeanCount() throws IOException {\n     }\n \n     public Object getAttribute(ObjectName name, String attribute) throws MBeanException, AttributeNotFoundException, InstanceNotFoundException, ReflectionException, IOException {\n-        return null;\n+        ModelNode request = new ModelNode();\n+        request.get(OP).set(GET_MBEAN_ATTRIBUTE_INFO_RAW);\n+        request.get(OP_ADDR).add(SUBSYSTEM, JMX);\n+\n+        request.get(MBEAN_NAME).set(name.toString());\n+        request.get(MBEAN_ATTRIBUTE_NAME).set(attribute);\n+\n+        ModelNode response = client.execute(request);\n+        if (!SUCCESS.equals(response.get(OUTCOME).asString())) {\n+            throw new IOException(\"Failed operation: \" + response.get(FAILURE_DESCRIPTION).toString());\n+        }\n+        byte[] bytes = response.get(RESULT).asBytes();\n+        try {\n+            return Object.class.cast(new ObjectInputStream(new ByteArrayInputStream(bytes)).readObject());\n+        } catch (ClassNotFoundException e) {\n+            throw new IOException(e);\n+        }\n     }\n \n     public AttributeList getAttributes(ObjectName name, String[] attributes) throws InstanceNotFoundException, ReflectionException, IOException {","filename":"arquillian/common/src/main/java/org/jboss/as/arquillian/container/TunneledMBeanServerConnection.java"},{"diff":"@@ -53,7 +53,7 @@\n \n     private static final String INVOKE_MBEAN_RAW = \"invoke-mbean-raw\";\n     private static final String GET_MBEAN_INFO_RAW = \"get-mbean-info-raw\";\n-\n+    private static final String GET_MBEAN_ATTRIBUTE_INFO_RAW = \"get-mbean-attribute-info-raw\";\n \n     private JMXSubsystemRootResource() {\n         super(PathElement.pathElement(ModelDescriptionConstants.SUBSYSTEM, JMXExtension.SUBSYSTEM_NAME),\n@@ -67,13 +67,12 @@ public void registerAttributes(ManagementResourceRegistration resourceRegistrati\n         resourceRegistration.registerReadWriteAttribute(SHOW_MODEL, null, new JMXWriteAttributeHandler(SHOW_MODEL));\n     }\n \n-\n-\n     @Override\n     public void registerOperations(ManagementResourceRegistration resourceRegistration) {\n         super.registerOperations(resourceRegistration);\n         resourceRegistration.registerOperationHandler(INVOKE_MBEAN_RAW, new InvokeMBeanRaw(), EMPTY_DESCRIPTION , false, EntryType.PRIVATE);\n         resourceRegistration.registerOperationHandler(GET_MBEAN_INFO_RAW, new GetMBeanInfoRaw(), EMPTY_DESCRIPTION, false, EntryType.PRIVATE);\n+        resourceRegistration.registerOperationHandler(GET_MBEAN_ATTRIBUTE_INFO_RAW, new GetMBeanAttributeInfoRaw(), EMPTY_DESCRIPTION, false, EntryType.PRIVATE);\n     }\n \n     private static DescriptionProvider EMPTY_DESCRIPTION = new DescriptionProvider() {","filename":"jmx/src/main/java/org/jboss/as/jmx/JMXSubsystemRootResource.java"}],"committer":{"login":"ropalka","name":"Richard Opalka","email":"opalka.richard@gmail.com"},"committed_date":"2012-01-06T02:58:46-08:00","added":["jmx/src/main/java/org/jboss/as/jmx/GetMBeanAttributeInfoRaw.java"],"authored_date":"2012-01-05T07:34:22-08:00"}}