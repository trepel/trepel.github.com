{"commit":{"tree":"167fd2e93d039249c969bbe95e0ad6f675dd4a5b","committed_date":"2011-03-10T13:15:44-08:00","authored_date":"2011-03-07T10:45:26-08:00","committer":{"login":"kabir","email":"kkhan@redhat.com","name":"kabir"},"url":"/jbossas/jboss-as/commit/b8382acb7f632d3581ed995c8128be2e50c58de4","added":["arquillian/cdi-testenricher-service/pom.xml","arquillian/cdi-testenricher-service/src/main/resources/META-INF/services/org.jboss.arquillian.spi.TestEnricher","arquillian/jsfunit-processor-service/pom.xml","arquillian/jsfunit-processor-service/src/main/resources/META-INF/services/org.jboss.arquillian.spi.ApplicationArchiveProcessor","arquillian/resource-testenricher-service/pom.xml","arquillian/resource-testenricher-service/src/main/resources/META-INF/services/org.jboss.arquillian.spi.TestEnricher","arquillian/servlet-protocol/pom.xml","arquillian/servlet-protocol/src/main/java/org/jboss/as/arquillian/protocol/servlet/ProtocolDeploymentAppender.java","arquillian/servlet-protocol/src/main/java/org/jboss/as/arquillian/protocol/servlet/ServletMethodExecutor.java","arquillian/servlet-protocol/src/main/java/org/jboss/as/arquillian/protocol/servlet/ServletTestRunner.java","arquillian/servlet-protocol/src/main/java/org/jboss/as/arquillian/protocol/servlet/WebContext.java","arquillian/servlet-protocol/src/main/resources/META-INF/services/org.jboss.arquillian.spi.AuxiliaryArchiveAppender","arquillian/servlet-protocol/src/main/resources/org/jboss/as/arquillian/protocol/servlet/web-fragment.xml","build/src/main/resources/modules/org/jboss/arquillian/testenricher/resource/main/module.xml","build/src/main/resources/modules/org/jboss/as/arquillian/protocol/servlet/main/module.xml","build/src/main/resources/modules/org/jboss/jsfunit/arquillian/main/module.xml","build/src/main/resources/modules/org/jboss/jsfunit/core/main/module.xml","build/src/main/resources/modules/org/jboss/jsfunit/jsfunit-arquillian-processor/main/module.xml","build/src/main/resources/modules/org/jboss/surefire/arquillian-jsfunit-deps/main/module.xml","testsuite/smoke/boot.log","testsuite/smoke/src/test/java/org/jboss/as/test/embedded/jsf/JSFTestCase.java","testsuite/smoke/src/test/resources/jsf-example.war/WEB-INF/faces-config.xml","testsuite/smoke/src/test/resources/jsf-example.war/WEB-INF/web.xml","testsuite/smoke/src/test/resources/jsf-example.war/index.xhtml","testsuite/smoke/src/test/resources/modules/jsf-arquillian-module-def.xml"],"parents":[{"id":"95f35fcf55d9b4024e04b7361ec688416e7f926c"}],"message":"Add Stan's JSF getting started example as a smoke test","author":{"login":"kabir","email":"kkhan@redhat.com","name":"kabir"},"modified":[{"diff":"@@ -54,9 +54,8 @@\n           <artifactId>arquillian-protocol-osgi</artifactId>\n         </dependency>\n         <dependency>\n-          <groupId>org.jboss.arquillian.protocol</groupId>\n-          <artifactId>arquillian-protocol-servlet-3</artifactId>\n-          <scope>provided</scope>\n+          <groupId>org.jboss.as</groupId>\n+          <artifactId>jboss-as-arquillian-servlet-protocol</artifactId>\n         </dependency>\n         <dependency>\n           <groupId>org.jboss.arquillian.testenricher</groupId>","filename":"arquillian/common/pom.xml"},{"diff":"@@ -29,12 +29,12 @@\n import javax.management.MalformedObjectNameException;\n import javax.management.ObjectName;\n \n-import org.jboss.arquillian.protocol.servlet_3.ServletMethodExecutor;\n import org.jboss.arquillian.spi.Configuration;\n import org.jboss.arquillian.spi.ContainerMethodExecutor;\n import org.jboss.arquillian.spi.Context;\n import org.jboss.arquillian.spi.DeployableContainer;\n import org.jboss.arquillian.spi.DeploymentException;\n+import org.jboss.as.arquillian.protocol.servlet.ServletMethodExecutor;\n import org.jboss.as.controller.client.ModelControllerClient;\n import org.jboss.as.server.client.api.deployment.DeploymentAction;\n import org.jboss.as.server.client.api.deployment.DeploymentPlan;","filename":"arquillian/common/src/main/java/org/jboss/as/arquillian/container/AbstractDeployableContainer.java"},{"diff":"@@ -42,7 +42,7 @@\n  */\n public class ModuleApplicationArchiveProcessor implements ApplicationArchiveProcessor {\n \n-    static List<String> defaultDependencies = new ArrayList<String>();\n+    static final List<String> defaultDependencies = new ArrayList<String>();\n     static {\n         defaultDependencies.add(\"org.jboss.arquillian.api\");\n         defaultDependencies.add(\"org.jboss.arquillian.junit\");\n@@ -54,6 +54,11 @@\n         defaultDependencies.add(\"org.jboss.shrinkwrap.impl\");\n         defaultDependencies.add(\"junit.junit\");\n     }\n+    static final List<String> jsfDependencies = new ArrayList<String>();\n+    static {\n+        jsfDependencies.add(\"org.jboss.jsfunit.arquillian\");\n+        jsfDependencies.add(\"org.jboss.jsfunit.core\");\n+    }\n \n     @Override\n     public void process(Archive<?> appArchive, TestClass testClass) {\n@@ -68,6 +73,13 @@ public void process(Archive<?> appArchive, TestClass testClass) {\n             if (moduleDeps.indexOf(dep) < 0)\n                 moduleDeps.append(\",\" + dep);\n         }\n+        if (Boolean.valueOf(System.getProperty(\"jboss.arquillian.jsfunit\", \"false\"))) {\n+            for (String dep : jsfDependencies) {\n+                if (moduleDeps.indexOf(dep) < 0) {\n+                    moduleDeps.append(\",\" + dep);\n+                }\n+            }\n+        }\n         attributes.putValue(\"Dependencies\", moduleDeps.toString());\n \n         // Add the manifest to the archive","filename":"arquillian/common/src/main/java/org/jboss/as/arquillian/container/ModuleApplicationArchiveProcessor.java"},{"diff":"@@ -48,6 +48,11 @@\n \n         <dependency>\n             <groupId>org.jboss.as</groupId>\n+            <artifactId>jboss-as-arquillian-servlet-protocol</artifactId>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.jboss.as</groupId>\n             <artifactId>jboss-as-server</artifactId>\n         </dependency>\n \n@@ -68,6 +73,7 @@\n             <artifactId>javax.inject</artifactId>\n             <scope>test</scope>\n         </dependency>\n+\n     </dependencies>\n \n     <build>","filename":"arquillian/container-embedded/pom.xml"},{"diff":"@@ -41,9 +41,13 @@\n     <modules>\n         <module>common</module>\n         <module>service</module>\n+        <module>cdi-testenricher-service</module>\n         <module>container-embedded</module>\n         <module>container-managed</module>\n         <module>container-remote</module>\n+        <module>jsfunit-processor-service</module>\n+        <module>resource-testenricher-service</module>\n+        <module>servlet-protocol</module>\n     </modules>\n \n     <packaging>pom</packaging>","filename":"arquillian/pom.xml"},{"diff":"@@ -327,6 +327,7 @@\n \n         <module-def name=\"org.jboss.arquillian.testenricher.cdi\">\n             <maven-resource group=\"org.jboss.arquillian.testenricher\" artifact=\"arquillian-testenricher-cdi\"/>\n+        \t   <maven-resource group=\"org.jboss.as\" artifact=\"jboss-as-arquillian-cdi-testenricher-service\"/>\n         </module-def>\n \n         <module-def name=\"org.jboss.arquillian.testenricher.jmx\">\n@@ -340,13 +341,22 @@\n         <module-def name=\"org.jboss.arquillian.testenricher.osgi\">\n             <maven-resource group=\"org.jboss.arquillian.testenricher\" artifact=\"arquillian-testenricher-osgi\"/>\n         </module-def>\n-        \n+\n+        <module-def name=\"org.jboss.arquillian.testenricher.resource\">\n+            <maven-resource group=\"org.jboss.arquillian.testenricher\" artifact=\"arquillian-testenricher-resource\"/>\n+            <maven-resource group=\"org.jboss.as\" artifact=\"jboss-as-arquillian-resource-testenricher-service\"/>\n+        </module-def>\n+\n         <module-def name=\"org.jboss.as.aggregate\" />\n \n         <module-def name=\"org.jboss.as.arquillian.common\">\n             <maven-resource group=\"org.jboss.as\" artifact=\"jboss-as-arquillian-common\"/>\n         </module-def>\n-\n+    \t\n+        <module-def name=\"org.jboss.as.arquillian.protocol.servlet\">\n+            <maven-resource group=\"org.jboss.as\" artifact=\"jboss-as-arquillian-servlet-protocol\"/>\n+        </module-def>\n+    \t\n         <module-def name=\"org.jboss.as.arquillian.service\">\n             <maven-resource group=\"org.jboss.as\" artifact=\"jboss-as-arquillian-service\"/>\n         </module-def>\n@@ -540,7 +550,38 @@\n         <module-def name=\"org.jboss.jandex\">\n             <maven-resource group=\"org.jboss\" artifact=\"jandex\"/>\n         </module-def>\n+      \n+    \t  <module-def name=\"org.jboss.jsfunit.arquillian\">\n+            <maven-resource group=\"org.jboss.jsfunit\" artifact=\"jsfunit-arquillian\"/>\n+        </module-def>\n+\n+        <module-def name=\"org.jboss.jsfunit.core\">\n+        \t   <maven-resource group=\"commons-codec\" artifact=\"commons-codec\"/>\n+            <maven-resource group=\"commons-collections\" artifact=\"commons-collections\"/>\n+            <maven-resource group=\"commons-io\" artifact=\"commons-io\"/>\n+            <maven-resource group=\"commons-lang\" artifact=\"commons-lang\"/>\n+        \t   <maven-resource group=\"commons-logging\" artifact=\"commons-logging\"/>\n+            <maven-resource group=\"net.sourceforge.cssparser\" artifact=\"cssparser\"/>\n+            <maven-resource group=\"net.sourceforge.htmlunit\" artifact=\"htmlunit\"/>\n+            <maven-resource group=\"net.sourceforge.htmlunit\" artifact=\"htmlunit-core-js\"/>\n+            <maven-resource group=\"net.sourceforge.nekohtml\" artifact=\"nekohtml\"/>\n+            <maven-resource group=\"org.apache.httpcomponents\" artifact=\"httpclient\"/>\n+            <maven-resource group=\"org.apache.httpcomponents\" artifact=\"httpcore\"/>\n+            <maven-resource group=\"org.apache.httpcomponents\" artifact=\"httpmime\"/>\n+            <maven-resource group=\"org.apache.james\" artifact=\"apache-mime4j\"/>\n+            <maven-resource group=\"org.jboss.jsfunit\" artifact=\"jboss-jsfunit-core\"/>\n+            <maven-resource group=\"org.w3c.css\" artifact=\"sac\"/>\n+            <maven-resource group=\"xalan\" artifact=\"xalan\"/>\n+            <maven-resource group=\"xalan\" artifact=\"serializer\"/>\n+            <maven-resource group=\"xerces\" artifact=\"xercesImpl\"/>\n+            <maven-resource group=\"xml-apis\" artifact=\"xml-apis\"/>\n+        \t\n+        </module-def>\n \n+        <module-def name=\"org.jboss.jsfunit.jsfunit-arquillian-processor\">\n+            <maven-resource group=\"org.jboss.as\" artifact=\"jboss-as-arquillian-jsfunit-processor-service\"/>\n+        </module-def>\n+    \t\n         <module-def name=\"org.jboss.jts\">\n             <maven-resource group=\"org.jboss.jbossts\" artifact=\"jbossjts\"/>\n         </module-def>\n@@ -648,7 +689,9 @@\n \n     \t  <module-def name=\"org.jboss.surefire.arquillian-deps\"/>\n     \t\n-        <module-def name=\"org.jboss.staxmapper\">\n+        <module-def name=\"org.jboss.surefire.arquillian-jsfunit-deps\"/>\n+\n+    \t  <module-def name=\"org.jboss.staxmapper\">\n             <maven-resource group=\"org.jboss\" artifact=\"staxmapper\"/>\n         </module-def>\n ","filename":"build/build.xml"},{"diff":"@@ -417,6 +417,31 @@\n         </dependency>\n         \n         <dependency>\n+           <groupId>org.jboss.arquillian.testenricher</groupId>\n+           <artifactId>arquillian-testenricher-resource</artifactId>\n+        </dependency>\n+        \n+        <dependency>\n+           <groupId>org.jboss.as</groupId>\n+           <artifactId>jboss-as-arquillian-cdi-testenricher-service</artifactId>\n+        </dependency>\n+\n+        <dependency>\n+           <groupId>org.jboss.as</groupId>\n+           <artifactId>jboss-as-arquillian-jsfunit-processor-service</artifactId>\n+        </dependency>\n+\n+        <dependency>\n+          <groupId>org.jboss.as</groupId>\n+          <artifactId>jboss-as-arquillian-resource-testenricher-service</artifactId>\n+        </dependency>\n+\n+        <dependency>\n+          <groupId>org.jboss.as</groupId>\n+          <artifactId>jboss-as-arquillian-servlet-protocol</artifactId>\n+        </dependency>\n+\n+        <dependency>\n             <groupId>org.jboss.as</groupId>\n             <artifactId>jboss-as-arquillian-service</artifactId>\n         </dependency>\n@@ -669,6 +694,16 @@\n         </dependency>\n \n         <dependency>\n+            <groupId>org.jboss.jsfunit</groupId>\n+            <artifactId>jsfunit-arquillian</artifactId>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.jboss.jsfunit</groupId>\n+            <artifactId>jboss-jsfunit-core</artifactId>\n+        </dependency>\n+\n+        <dependency>\n             <groupId>org.jboss.logging</groupId>\n             <artifactId>jboss-logging</artifactId>\n         </dependency>","filename":"build/pom.xml"},{"diff":"@@ -40,6 +40,7 @@\n         <module name=\"org.jboss.arquillian.testenricher.jmx\" services=\"import\"/>\n         <module name=\"org.jboss.arquillian.testenricher.msc\" services=\"import\"/>\n         <module name=\"org.jboss.arquillian.testenricher.osgi\" services=\"import\"/>\n+        <module name=\"org.jboss.arquillian.testenricher.resource\" services=\"import\"/>\n         <module name=\"org.jboss.as.arquillian.common\"/>\n         <module name=\"org.jboss.as.controller\"/>\n         <module name=\"org.jboss.as.server\" />","filename":"build/src/main/resources/modules/org/jboss/as/arquillian/service/main/module.xml"},{"diff":"@@ -97,6 +97,7 @@\n         <version.org.jboss.jbossts.jbossjts>4.14.0.Final</version.org.jboss.jbossts.jbossjts>\n         <version.org.jboss.jbossts.jbossjts-integration>4.14.0.Final</version.org.jboss.jbossts.jbossjts-integration>\n         <version.org.jboss.jboss-vfs>3.0.0.GA</version.org.jboss.jboss-vfs>\n+        <version.org.jboss.jsfunit.jsfunit>2.0.0.Beta1</version.org.jboss.jsfunit.jsfunit>\n         <version.org.jboss.logging.jboss-logging>3.0.0.Beta3</version.org.jboss.logging.jboss-logging>\n         <version.org.jboss.logmanager.jboss-logmanager>1.2.0.CR7</version.org.jboss.logmanager.jboss-logmanager>\n         <version.org.jboss.logmanager.jboss-logmanager-log4j>1.0.0.CR3</version.org.jboss.logmanager.jboss-logmanager-log4j>\n@@ -1650,6 +1651,24 @@\n \n             <dependency>\n                 <groupId>org.jboss.as</groupId>\n+                <artifactId>jboss-as-arquillian-cdi-testenricher-service</artifactId>\n+                <version>${project.version}</version>\n+            </dependency>\n+            \n+            <dependency>\n+                <groupId>org.jboss.as</groupId>\n+                <artifactId>jboss-as-arquillian-jsfunit-processor-service</artifactId>\n+                <version>${project.version}</version>\n+            </dependency>\n+\n+\t         <dependency>\n+\t             <groupId>org.jboss.as</groupId>\n+\t             <artifactId>jboss-as-arquillian-resource-testenricher-service</artifactId>\n+                <version>${project.version}</version>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>org.jboss.as</groupId>\n                 <artifactId>jboss-as-arquillian-common</artifactId>\n                 <version>${project.version}</version>\n             </dependency>\n@@ -1680,6 +1699,12 @@\n \n             <dependency>\n                 <groupId>org.jboss.as</groupId>\n+                <artifactId>jboss-as-arquillian-servlet-protocol</artifactId>\n+                <version>${project.version}</version>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>org.jboss.as</groupId>\n                 <artifactId>jboss-as-build</artifactId>\n                 <type>pom</type>\n                 <version>${project.version}</version>\n@@ -2234,12 +2259,6 @@\n             </dependency>\n \n             <dependency>\n-              <groupId>org.jboss.arquillian.protocol</groupId>\n-              <artifactId>arquillian-protocol-servlet-3</artifactId>\n-              <version>${version.org.jboss.arquillian}</version>\n-            </dependency>\n-\n-            <dependency>\n                 <groupId>org.jboss.arquillian.testenricher</groupId>\n                 <artifactId>arquillian-testenricher-cdi</artifactId>\n                 <version>${version.org.jboss.arquillian}</version>\n@@ -2264,6 +2283,12 @@\n                 <version>${version.org.jboss.arquillian}</version>\n             </dependency>\n \n+\t         <dependency>\n+\t             <groupId>org.jboss.arquillian.testenricher</groupId>\n+\t             <artifactId>arquillian-testenricher-resource</artifactId>\n+                <version>${version.org.jboss.arquillian}</version>\n+\t         </dependency>\n+\n             <dependency>\n                 <groupId>org.jboss.ejb3.effigy</groupId>\n                 <artifactId>jboss-ejb3-effigy-int2</artifactId>\n@@ -2699,6 +2724,18 @@\n             </dependency>\n \n             <dependency>\n+                <groupId>org.jboss.jsfunit</groupId>\n+                <artifactId>jsfunit-arquillian</artifactId>\n+                <version>${version.org.jboss.jsfunit.jsfunit}</version>\n+            </dependency>\n+\n+            <dependency>\n+                <groupId>org.jboss.jsfunit</groupId>\n+                <artifactId>jboss-jsfunit-core</artifactId>\n+                <version>${version.org.jboss.jsfunit.jsfunit}</version>\n+            </dependency>\n+\n+            <dependency>\n                 <groupId>org.jboss.logging</groupId>\n                 <artifactId>jboss-logging</artifactId>\n                 <version>${version.org.jboss.logging.jboss-logging}</version>","filename":"pom.xml"},{"diff":"@@ -51,7 +51,12 @@\n     <dependencies>\n         <dependency>\n             <groupId>org.jboss.as</groupId>\n-            <artifactId>jboss-as-server</artifactId>\n+            <artifactId>jboss-as-arquillian-container-embedded</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.jboss.as</groupId>\n+            <artifactId>jboss-as-arquillian-servlet-protocol</artifactId>\n             <scope>test</scope>\n         </dependency>\n         <dependency>\n@@ -61,9 +66,14 @@\n         </dependency>\n         <dependency>\n             <groupId>org.jboss.as</groupId>\n-            <artifactId>jboss-as-arquillian-container-embedded</artifactId>\n+            <artifactId>jboss-as-server</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+           <groupId>org.jboss.jsfunit</groupId>\n+           <artifactId>jsfunit-arquillian</artifactId>\n+           <scope>test</scope>\n+        </dependency>\n     </dependencies>\n \n     <build>\n@@ -74,7 +84,7 @@\n                 <configuration>\n                     <skipTests>false</skipTests>\n                     <!--  standard surefire options -->\n-                    <redirectTestOutputToFile>false</redirectTestOutputToFile>                    \n+                    <redirectTestOutputToFile>true</redirectTestOutputToFile>                    \n                     <enableAssertions>true</enableAssertions>\n                     <systemProperties>\n                         <property>\n@@ -180,7 +190,7 @@\n                                       <include>org/jboss/as/test/embedded/**/*TestCase.java</include>\n                                    </includes>\n                                    <excludes>\n-                                      <exclude>org/jboss/as/test/embedded/nothing-to-exclude/*TestCase.java</exclude>\n+                                      <exclude>org/jboss/as/test/embedded/jsf/*TestCase.java</exclude>\n                                    </excludes>\n                                </configuration>\n                             </execution>\n@@ -218,7 +228,65 @@\n                 </plugins>\n             </build>\n         </profile>\n+        <profile>\n+            <id>modular-jsf</id>\n+            <activation>\n+                <activeByDefault>true</activeByDefault>\n+            </activation>\n+            <build>\n+                <plugins>\n+                    <plugin>\n+                        <groupId>org.jboss.maven.surefire.modular</groupId>\n+                        <artifactId>maven-surefire-plugin</artifactId>\n+                        <executions>\n+                            <execution>\n+                               <id>modular-jsf-arquillian</id>\n+                               <phase>test</phase>\n+                               <goals>\n+                                   <goal>test</goal>\n+                               </goals>\n+                               <configuration>\n+                                   <moduleDefinitionFile>${project.basedir}/src/test/resources/modules/jsf-arquillian-module-def.xml</moduleDefinitionFile>\n+                                   <includes>\n+                                       <exclude>org/jboss/as/test/embedded/jsf/*TestCase.java</exclude>\n+                                   </includes>\n+\t\t\t                          <systemProperties>\n+\t\t\t                              <property>\n+\t\t\t                                 <name>jboss.arquillian.executeWithServlet</name>\n+\t\t\t                                 <value>true</value>\n+\t\t\t                              </property>\n+\t\t\t                              <property>\n+\t\t\t                                 <name>jboss.arquillian.jsfunit</name>\n+\t\t\t                                 <value>true</value>\n+\t\t\t                              </property>\n+\t\t\t                              <!--  Need to specify these again, since just including one property for this excution overwrites all the others -->\n+\t\t\t                              <property>\n+\t\t\t                                 <name>java.util.logging.manager</name>\n+\t\t\t                                 <value>org.jboss.logmanager.LogManager</value>\n+\t\t\t                              </property>\n+\t\t\t                              <property>\n+\t\t\t                                 <name>jboss.home.dir</name>\n+\t\t\t                                 <value>${jboss.home}</value>\n+\t\t\t                              </property>\n+\t\t\t                              <property>\n+\t\t\t                                 <name>org.jboss.boot.log.file</name>\n+\t\t\t                                 <value>${jboss.home}/standalone/log/boot.log</value>\n+\t\t\t                              </property>\n+\t\t\t                              <property>\n+\t\t\t                                 <name>jboss.embedded.root</name>\n+\t\t\t                                 <value>target/temp-config</value>\n+\t\t\t                              </property>\n+\t\t\t                          </systemProperties>\n+\t\t                             <includes>\n+\t\t                                 <include>org/jboss/as/test/embedded/jsf/*TestCase.java</include>\n+\t\t                             </includes>\n+                               </configuration>\n+                            </execution>\n+                        </executions>\n+                    </plugin>\n+                </plugins>\n+            </build>\n+        </profile>\n     </profiles>\n-    \n </project>\n ","filename":"testsuite/smoke/pom.xml"},{"diff":"@@ -80,6 +80,13 @@ public static WebArchive createWebArchive(String archiveName, Class<?>...classes\n         return archive;\n     }\n \n+    public static WebArchive createWebArchive(String archiveName, String resourcesName, Class<?>...classes) {\n+        WebArchive archive = ShrinkWrap.create(WebArchive.class, getBaseArchiveName(archiveName));\n+        addClasses(archive, classes);\n+        addResources(resourcesName, archive);\n+        return archive;\n+    }\n+\n     public static JavaArchive createEmptyJavaArchive(String archiveName) {\n \n         int index = archiveName.lastIndexOf(\"/\");","filename":"testsuite/smoke/src/test/java/org/jboss/as/test/modular/utils/ShrinkWrapUtils.java"},{"diff":"@@ -32,6 +32,7 @@\n \n import org.jboss.as.server.deployment.SetupAction;\n import org.jboss.logging.Logger;\n+import org.jboss.weld.Container;\n import org.jboss.weld.context.bound.BoundConversationContext;\n import org.jboss.weld.context.bound.BoundLiteral;\n import org.jboss.weld.context.bound.BoundRequest;\n@@ -67,7 +68,7 @@ public void setup(Map<String, Object> properties) {\n         try {\n             final BeanManager manager = (BeanManager) new InitialContext().lookup(STANDARD_BEAN_MANAGER_JNDI_NAME);\n \n-            if (manager != null) {\n+            if (manager != null && Container.available()) {\n \n                 final Bean<BoundSessionContext> sessionContextBean = (Bean<BoundSessionContext>) manager.resolve(manager\n                         .getBeans(BoundSessionContext.class, BoundLiteral.INSTANCE));\n@@ -105,29 +106,31 @@ public void teardown(Map<String, Object> properties) {\n         try {\n             final BeanManager manager = (BeanManager) new InitialContext().lookup(\"java:comp/BeanManager\");\n \n-            final Bean<BoundSessionContext> sessionContextBean = (Bean<BoundSessionContext>) manager.resolve(manager.getBeans(\n-                    BoundSessionContext.class, BoundLiteral.INSTANCE));\n-            CreationalContext<?> ctx = manager.createCreationalContext(sessionContextBean);\n-            final BoundSessionContext sessionContext = (BoundSessionContext) manager.getReference(sessionContextBean,\n-                    BoundSessionContext.class, ctx);\n-            sessionContext.deactivate();\n-            sessionContext.dissociate(sessionContexts.get());\n-\n-            final Bean<BoundRequestContext> requestContextBean = (Bean<BoundRequestContext>) manager.resolve(manager.getBeans(\n-                    BoundRequestContext.class, BoundLiteral.INSTANCE));\n-            ctx = manager.createCreationalContext(requestContextBean);\n-            final BoundRequestContext requestContext = (BoundRequestContext) manager.getReference(requestContextBean,\n-                    BoundRequestContext.class, ctx);\n-            requestContext.deactivate();\n-            requestContext.dissociate(requestContexts.get());\n-\n-            final Bean<BoundConversationContext> conversationContextBean = (Bean<BoundConversationContext>) manager\n-                    .resolve(manager.getBeans(BoundConversationContext.class, BoundLiteral.INSTANCE));\n-            ctx = manager.createCreationalContext(conversationContextBean);\n-            final BoundConversationContext conversationContext = (BoundConversationContext) manager.getReference(\n-                    conversationContextBean, BoundConversationContext.class, ctx);\n-            conversationContext.deactivate();\n-            conversationContext.dissociate(boundRequests.get());\n+            if (manager != null && Container.available()) {\n+                final Bean<BoundSessionContext> sessionContextBean = (Bean<BoundSessionContext>) manager.resolve(manager.getBeans(\n+                        BoundSessionContext.class, BoundLiteral.INSTANCE));\n+                CreationalContext<?> ctx = manager.createCreationalContext(sessionContextBean);\n+                final BoundSessionContext sessionContext = (BoundSessionContext) manager.getReference(sessionContextBean,\n+                        BoundSessionContext.class, ctx);\n+                sessionContext.deactivate();\n+                sessionContext.dissociate(sessionContexts.get());\n+\n+                final Bean<BoundRequestContext> requestContextBean = (Bean<BoundRequestContext>) manager.resolve(manager.getBeans(\n+                        BoundRequestContext.class, BoundLiteral.INSTANCE));\n+                ctx = manager.createCreationalContext(requestContextBean);\n+                final BoundRequestContext requestContext = (BoundRequestContext) manager.getReference(requestContextBean,\n+                        BoundRequestContext.class, ctx);\n+                requestContext.deactivate();\n+                requestContext.dissociate(requestContexts.get());\n+\n+                final Bean<BoundConversationContext> conversationContextBean = (Bean<BoundConversationContext>) manager\n+                        .resolve(manager.getBeans(BoundConversationContext.class, BoundLiteral.INSTANCE));\n+                ctx = manager.createCreationalContext(conversationContextBean);\n+                final BoundConversationContext conversationContext = (BoundConversationContext) manager.getReference(\n+                        conversationContextBean, BoundConversationContext.class, ctx);\n+                conversationContext.deactivate();\n+                conversationContext.dissociate(boundRequests.get());\n+            }\n         } catch (NamingException e) {\n             log.error(\"Failed to tear down Weld contexts\", e);\n         } finally {","filename":"weld/src/main/java/org/jboss/as/weld/arquillian/WeldContextSetup.java"}],"id":"b8382acb7f632d3581ed995c8128be2e50c58de4"}}