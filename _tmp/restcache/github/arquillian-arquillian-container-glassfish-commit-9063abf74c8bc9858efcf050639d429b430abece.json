{"commit":{"id":"9063abf74c8bc9858efcf050639d429b430abece","message":"[ARQ-606] Fixed failing deployment upon GlassFish WARNING","committer":{"name":"Pedro Kowalski","email":"pallipp@gmail.com","login":""},"committed_date":"2011-10-04T07:43:40-07:00","url":"/arquillian/arquillian-container-glassfish/commit/9063abf74c8bc9858efcf050639d429b430abece","authored_date":"2011-09-21T02:38:35-07:00","parents":[{"id":"2b5c0726fdaf7a6eadac9bf5795ea13df88b4152"}],"author":{"name":"Pedro Kowalski","email":"pallipp@gmail.com","login":""},"modified":[{"filename":"glassfish-remote-3.1/src/main/java/org/jboss/arquillian/container/glassfish/remote_3_1/clientutils/GlassFishClientUtil.java","diff":"@@ -48,8 +48,16 @@\n \n public class GlassFishClientUtil {\n \t\n+   /**\n+    * Status for a successful GlassFish exit code deployment.\n+    */\n \tpublic static final String SUCCESS = \"SUCCESS\";\n \t\n+\t/**\n+\t * Status for a GlassFish exit code deployment which ended in warning.\n+\t */\n+\tpublic static final String WARNING = \"WARNING\";\n+\t\n \tprivate GlassFishRestConfiguration configuration;\n \t\n \tprivate String adminBaseUrl;\n@@ -157,10 +165,20 @@ private Map getResponceMap(ClientResponse response) throws ContainerException\n     \tClientResponse.Status status = ClientResponse.Status.fromStatusCode(response.getStatus());\n \t    if ( status.getFamily() == javax.ws.rs.core.Response.Status.Family.SUCCESSFUL ) {\n \t\t\t\n-\t    \t// O.K. the jersey call was successful, what about the GlassFish server response?\n-\t    \tif ( responseMap.get(\"exit_code\") == null || !SUCCESS.equals(responseMap.get(\"exit_code\")) ) {\n-\t    \t\tthrow new GlassFishClientException(message);\n-\t    \t}\n+\t       // O.K. the jersey call was successful, what about the GlassFish server response?\n+           if (responseMap.get(\"exit_code\") == null) {\n+              throw new GlassFishClientException(message);\n+           }\n+           \n+           else if (WARNING.equals(responseMap.get(\"exit_code\"))) {\n+              // Warning is not a failure - some warnings in GlassFish are inevitable (i.e. persistence-related: ARQ-606)\n+              log.warning(\"Deployment resulted in a warning: \" + message);\n+           }\n+           \n+           else if (!SUCCESS.equals(responseMap.get(\"exit_code\"))) {\n+              // Response is not a warning nor success - it's surely a failure.\n+              throw new GlassFishClientException(message);\n+           }\n \t\t\t\n \t    } else if (status.getReasonPhrase() == \"Not Found\") {\n \t    \t// the REST resource can not be found (for optional resources it can be O.K.)"}],"tree":"0d9e781c2ecc3c2c0972756d187a66bc7c52e3d7"}}