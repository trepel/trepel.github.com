{"commit":{"tree":"e8087f3199d614e9ac3d6e2531a8cdd3856c6236","parents":[{"id":"f329831338a9e7127e266833e2c6228207658b66"}],"authored_date":"2011-10-18T12:01:24-07:00","id":"106c718893be73eb29e85e6c044ff40a93aeee33","added":["glassfish-embedded-3.1/src/test/resources/sun-resources2.xml"],"url":"/arquillian/arquillian-container-glassfish/commit/106c718893be73eb29e85e6c044ff40a93aeee33","committer":{"email":"aslak@redhat.com","name":"Aslak Knutsen","login":"aslakknutsen"},"committed_date":"2011-10-20T14:09:36-07:00","message":"ARQ-635 Support of multiple sun-resources","author":{"email":"Konrad.Fischer@rittelfischer.com","name":"Konrad Fischer","login":"kafis"},"modified":[{"filename":"glassfish-embedded-3.1/src/main/java/org/jboss/arquillian/container/glassfish/embedded_3_1/GlassFishConfiguration.java","diff":"@@ -20,7 +20,9 @@\n import java.io.FileFilter;\n import java.io.FilenameFilter;\n import java.net.URI;\n+import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.Collections;\n import java.util.List;\n import java.util.logging.Logger;\n \n@@ -106,9 +108,17 @@ public void setConfigurationXml(String configurationXml)\n       this.configurationXml = configurationXml;\n    }\n \n-   public String getSunResourcesXml()\n+   public List<String> getSunResourcesXml()\n    {\n-      return sunResourcesXml;\n+       if(sunResourcesXml == null){\n+           return Collections.emptyList();\n+       }\n+       List<String> resources = new ArrayList<String>();\n+       for(String resource : sunResourcesXml.split(\",\"))\n+       {\n+           resources.add(resource.trim());\n+       }\n+      return resources;\n    }\n \n    public void setSunResourcesXml(String sunResourcesXml)\n@@ -183,9 +193,14 @@ public void processConfig() throws RuntimeException\n             URI configurationXmlURI = convertFilePathToURI(configurationXml);\n             configurationXml = configurationXmlURI.toString();\n          }\n-         if (sunResourcesXml != null)\n+\n+         List<String> sunResourcesXml = getSunResourcesXml();\n+         if (sunResourcesXml.size() > 0)\n          {\n-            verifySunResourcesXml(sunResourcesXml);\n+            for(String sunResourceXml : sunResourcesXml)\n+            {\n+               verifySunResourcesXml(sunResourceXml);\n+            }\n          }\n       }\n "},{"filename":"glassfish-embedded-3.1/src/main/java/org/jboss/arquillian/container/glassfish/embedded_3_1/GlassFishContainer.java","diff":"@@ -152,17 +152,19 @@ public void start() throws LifecycleException\n          throw new LifecycleException(\"Could not start GlassFish Embedded\", e);\n       }\n       // Server needs to be started before we can deploy resources\n-      if(configuration.getSunResourcesXml() != null)\n+      for(String resource : configuration.getSunResourcesXml())\n       {\n-         try\n-         {\n-            executeCommand(COMMAND_ADD_RESOURCES, this.configuration.getSunResourcesXml());\n-         }\n-         catch (Throwable e) \n-         {\n-            throw new RuntimeException(\"Could not deploy sun-reosurces file: \" + configuration.getSunResourcesXml(), e);\n-         }\n-      }\n+          try\n+          {\n+             executeCommand(COMMAND_ADD_RESOURCES, resource);\n+          }\n+          catch (Throwable e)\n+          {\n+            throw new RuntimeException(\"Could not deploy sun-reosurces file: \" + resource, e);\n+          }\n+     }\n+\n+\n    }\n \n    /* (non-Javadoc)"},{"filename":"glassfish-embedded-3.1/src/test/java/org/jboss/arquillian/container/glassfish/embedded_3_1/app/MyServlet.java","diff":"@@ -42,10 +42,15 @@\n    public static final String MESSAGE = \"hello\";\n \n    @Resource(name = \"jdbc/arquillian\") private DataSource arquillianDS;\n+   @Resource(name = \"jdbc/arquillian2\") private DataSource arquillianDS2;\n \n    @Override\n    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException\n    {\n-      response.getWriter().append(arquillianDS != null ? MESSAGE : \"#fail\");\n+      response.getWriter().append(areDatasourcesSet() ? MESSAGE : \"#fail\");\n    }\n+\n+    private boolean areDatasourcesSet() {\n+        return arquillianDS != null && arquillianDS2 != null;\n+    }\n }\n\\ No newline at end of file"},{"filename":"glassfish-embedded-3.1/src/test/resources/arquillian.xml","diff":"@@ -6,7 +6,10 @@\n \n        <container qualifier=\"glassfish\" default=\"true\">\n            <configuration>\n-               <property name=\"sunResourcesXml\">src/test/resources/sun-resources.xml</property>\n+               <property name=\"sunResourcesXml\">\n+                   src/test/resources/sun-resources.xml,\n+                   src/test/resources/sun-resources2.xml\n+               </property>\n                <property name=\"bindHttpPort\">7070</property>\n            </configuration>\n        </container>"}]}}